const webpack = require("webpack");
import path from 'path';
import { lstatSync, readdirSync } from 'fs';

const isDirectory = source => lstatSync(source).isDirectory();
const getDirectories = source =>
  readdirSync(source).map(name => path.join(source, name)).filter(isDirectory);

export default (config, env, helpers) => {
  // getDirectories('src/').map((dir) => {
  //   config.resolve.alias[dir.replace('src/', '')] = path.resolve(__dirname, dir);
  // });
  // console.log(path.resolve(__dirname, 'node_modules/scrollmagic/scrollmagic/uncompressed/ScrollMagic.js'));

  const aliases = config.resolve.alias;
  aliases.react = "preact/compat";
  aliases["react-dom"] = "preact/compat";
  aliases["npm"] = 'node_modules';
  aliases["TweenLite"] = path.resolve(__dirname,  'node_modules/gsap/src/uncompressed/TweenLite.js');
  aliases["TweenMax"] = path.resolve(__dirname,  'node_modules/gsap/src/uncompressed/TweenMax.js');
  aliases["TimelineLite"] = path.resolve(__dirname,  'node_modules/gsap/src/uncompressed/TimelineLite.js');
  aliases["TimelineMax"] = path.resolve(__dirname,  'node_modules/gsap/src/uncompressed/TimelineMax.js');
  aliases["ScrollMagic"] = path.resolve(__dirname,  'node_modules/scrollmagic/scrollmagic/uncompressed/ScrollMagic.js');
  aliases["animation.gsap"] = path.resolve(__dirname,  'node_modules/scrollmagic/scrollmagic/uncompressed/plugins/animation.gsap.js');
  aliases["debug.addIndicators"] = path.resolve(__dirname,  'node_modules/scrollmagic/scrollmagic/uncompressed/plugins/debug.addIndicators.js');
  // let { plugin } = helpers.getPluginsByName(config, "UglifyJsPlugin")[0];
  // plugin.options.sourceMap = false
  config.plugins.push(new webpack.DefinePlugin({
    "process.env": {
      NODE_ENV: JSON.stringify("production")
    }
  }), new webpack.ProvidePlugin({
    jQuery: "jquery",
    $: "jquery",
    jquery: "jquery"
  }));
}
